<%@page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>

<!DOCTYPE HTML">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>CVE Browser</title>

<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style>

body {
	background-color: #cccccc;
}

.panel>.panel-heading {
	background: url('/image/banner.jpg');
	height: 145;
	color: white;
}

.pagination>li>a {
	color: black;
	float: left;
	padding-top: 6px;
	padding-left: 6px;
	padding-right: 22px;
	text-decoration: none;
	border-radius: 5px;
	background-color: #f5f5f5;
	width: 22;
}

.pagination>li.active>a {
	color: white;
	border-radius: 5px;
}

.panel-footer a {
	color: #FFFFFF;
	text-decoration: none;
}

</style>

</head>

<body>
	<div class="container">
		<div class="panel panel-default">
			<div class="panel-heading"></div>
			<div class="panel-body">
			
				<form:form method="Post" 
				action="${pageContext.request.contextPath}/cve/${currentYear}/${currentPage}"
				modelAttribute="vuln" class="form-inline container">

					<b>Vulnerability search:</b>
					<div class="form-group">
						<form:input type="text" id="vulnId" class="form-control"
							placeholder="Enter vulnerability identification number here ..."
							path="name" size="110"/>
						<button type="submit" class="btn btn-danger">Search</button>
					</div>
				</form:form>
				
			</div>
			
			<div class="panel-footer">
			
				<b>Select year:</b>
				<c:forEach begin="0" end="15" varStatus="loop">
					<a href="${pageContext.request.contextPath}/cve/${2017-loop.index}/1">
						<button type="submit" class="btn btn-primary btn-xs" id="btn-year">${2017-loop.index}</button>
					</a> &nbsp|&nbsp
				</c:forEach>
				
				<button type="button" class="btn btn-default btn-xs"
				data-toggle="collapse" data-target="#pages">Pages</button>
				
				<div id="pages" class="collapse">
					<ul class="pagination pagination-sm">
						<c:forEach begin="1" end="${pages+1}" varStatus="loop">
							<c:choose>
								<c:when test="${currentPage == loop.index}">
									<li class="active">
								</c:when>
								<c:otherwise>
									<li>
								</c:otherwise>
							</c:choose>
							<a href="${pageContext.request.contextPath}/cve/${currentYear}/${loop.index} ">${loop.index}</a>
									</li>
						</c:forEach>
					</ul>
				</div>
			</div>
		</div>
		
		<table class="table table-hover text-center">
			<thead>
				<tr>
					<th class="text-center">MORE</th>
					<th class="text-center">CVE ID</th>
					<th class="text-center">PUBLISH DATE</th>
					<th class="text-center">UPDATE DATE</th>
					<th class="text-center">SCORE 
					<a href="${pageContext.request.contextPath}/cve/${currentYear}/${currentPage}/sortedByScore${direction}"
					type="button" class="glyphicon glyphicon-sort"></a></th>
					<th class="text-center">VECTOR</th>
					<th class="text-center">EXPLOIT SCORE</th>
					<th class="text-center">SEVERITY</th>
				</tr>
			</thead>
			
			<tbody>
				<c:forEach items="${entiresWrapper.entries}" var="entry"
					varStatus="status">
					<c:if test="${entry.cvssBaseScore >= 7}">
						<tr class="danger">
					</c:if>
					<c:if test="${entry.cvssBaseScore >= 4 && entry.cvssBaseScore < 7}">
						<tr class="warning">
					</c:if>
					<c:if test="${entry.cvssBaseScore >= 0 && entry.cvssBaseScore < 4}">
						<tr class="success">
					</c:if>
					<c:if test="${empty entry.cvssBaseScore }">
						<tr class="success">
					</c:if>
					<td align="center" >
					<button type="button" class="btn btn-primary" data-toggle="modal"
						data-target="#myModal${entry.name}"></button></td>
						
					<td>${entry.name}</td>
					<td>${entry.published}</td>
					<td>${entry.modified}</td>
					<td>${entry.cvssScore}</td>
					<td>${entry.cvssVector}</td>
					<td>${entry.cvssExploitSubscore}</td>
					<td>${entry.severity}</td>

						</tr>

					<div class="modal fade" id="myModal${entry.name}" role="dialog">
						<div class="modal-dialog modal-lg">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal">&times;</button>
									<h4 class="modal-title"><b>${entry.name}</b></h4>
								</div>
								<div class="modal-body">
									<div class="well well-sm">
										<h4><b>Description:</b></h4>
										<h5>${entry.desc.descript[0].value}</h5>
									</div>
									
									<div class="well well-sm">
										<h4><b>Number Of Affected Versions By Product:</b></h4>
										
										<c:forEach items="${entry.vulnSoft.prod}" var="prod">
											<div class="well well-sm">

												<b>Product:</b> ${prod.name} <b>Vendor:</b> ${prod.vendor}
												<c:if test="${not empty prod.vers[0].num}">
													<b>Version:</b>${prod.vers[0].num}
												</c:if>
												<c:if test="${not empty prod.vers[0].edition}">
													<b>Update:</b> ${prod.vers[0].edition}
												</c:if>
												<br />
											</div>
										</c:forEach>

									</div>
									
									<div class="well well-sm">
										<h4><b>References For ${entry.name}:</b></h4>

										<c:forEach items="${entry.refs.ref}" var="ref">
											<div class="well well-sm">
												<b>Reference:</b> ${ref.source} ${ref.value}
												<c:if test="${not empty ref.url}">
													<b>URL:&nbsp</b>
													<a href="${ref.url}"> MORE</a>
												</c:if>
												<c:if test="${not empty ref.patch}">
													<b>Patch:</b> ${ref.patch}
												</c:if>

												<br />
											</div>
										</c:forEach>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">CLOSE</button>
								</div>
							</div>
						</div>
					</div>
				</c:forEach>
			</tbody>
		</table>
	</div>

</body>
</html>